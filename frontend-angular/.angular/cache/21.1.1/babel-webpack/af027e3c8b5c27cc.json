{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { PDFViewerComponent } from '../pdf-viewer/pdf-viewer.component';\nimport { DrawingCanvasComponent } from '../drawing-canvas/drawing-canvas.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../core/services/api.service\";\nimport * as i3 from \"../../core/services/state.service\";\nimport * as i4 from \"@angular/common\";\nfunction ProjectEditorComponent_div_0_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19);\n    i0.ɵɵelement(1, \"app-drawing-canvas\", 20);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"pdfCanvas\", ctx_r1.pdfCanvas)(\"viewport\", ctx_r1.viewport)(\"isActive\", ctx_r1.markerMode === \"terminal\" || ctx_r1.markerMode === \"dropPed\")(\"projectId\", ctx_r1.projectId);\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_14_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 23)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_ul_14_li_1_Template_button_click_3_listener() {\n      const t_r4 = i0.ɵɵrestoreView(_r3).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.removeTerminal(t_r4));\n    });\n    i0.ɵɵtext(4, \"Remove\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const i_r5 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Terminal \", ctx_r1.String.fromCharCode(65 + i_r5));\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 21);\n    i0.ɵɵtemplate(1, ProjectEditorComponent_div_0_ul_14_li_1_Template, 5, 1, \"li\", 22);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.terminals);\n  }\n}\nfunction ProjectEditorComponent_div_0_ng_template_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵtext(1, \"None placed\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_20_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 23)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_ul_20_li_1_Template_button_click_3_listener() {\n      const d_r7 = i0.ɵɵrestoreView(_r6).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.removeDrop(d_r7));\n    });\n    i0.ɵɵtext(4, \"Remove\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const i_r8 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Drop Ped \", ctx_r1.String.fromCharCode(65 + i_r8));\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 21);\n    i0.ɵɵtemplate(1, ProjectEditorComponent_div_0_ul_20_li_1_Template, 5, 1, \"li\", 22);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.drops);\n  }\n}\nfunction ProjectEditorComponent_div_0_ng_template_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵtext(1, \"None placed\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_26_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 23)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_ul_26_li_1_Template_button_click_3_listener() {\n      const seg_r10 = i0.ɵɵrestoreView(_r9).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.removeFiber(seg_r10));\n    });\n    i0.ɵɵtext(4, \"Remove\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const seg_r10 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate3(\"\", seg_r10.name || \"Route\", \" \\u2013 page \", seg_r10.page_number, \" \\u2013 \", seg_r10.length_ft ? seg_r10.length_ft.toFixed(1) : \"0.0\", \" ft\");\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 21);\n    i0.ɵɵtemplate(1, ProjectEditorComponent_div_0_ul_26_li_1_Template, 5, 3, \"li\", 22);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.fiberSegments);\n  }\n}\nfunction ProjectEditorComponent_div_0_ng_template_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵtext(1, \"No fiber drawn\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_32_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 23)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_ul_32_li_1_Template_button_click_3_listener() {\n      const c_r12 = i0.ɵɵrestoreView(_r11).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.removeConduit(c_r12));\n    });\n    i0.ɵɵtext(4, \"Remove\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const c_r12 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate4(\"Terminal \", c_r12.terminal_id, \" \\u2192 Drop \", c_r12.drop_ped_id, \" \\u2014 \", c_r12.footage ? c_r12.footage.toFixed(1) : \"0.0\", \" ft (page \", c_r12.page_number, \")\");\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_32_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 21);\n    i0.ɵɵtemplate(1, ProjectEditorComponent_div_0_ul_32_li_1_Template, 5, 4, \"li\", 22);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.conduits);\n  }\n}\nfunction ProjectEditorComponent_div_0_ng_template_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵtext(1, \"No conduits linked\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectEditorComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"div\", 6)(2, \"h2\", 7);\n    i0.ɵɵtext(3, \"Project Editor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.saveProject());\n    });\n    i0.ɵɵtext(5, \" Save Project \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 9)(7, \"div\", 10)(8, \"app-pdf-viewer\", 11);\n    i0.ɵɵlistener(\"canvasReady\", function ProjectEditorComponent_div_0_Template_app_pdf_viewer_canvasReady_8_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onCanvasReady($event));\n    })(\"polylinesChanged\", function ProjectEditorComponent_div_0_Template_app_pdf_viewer_polylinesChanged_8_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onPolylinesChanged($event));\n    })(\"terminalsChanged\", function ProjectEditorComponent_div_0_Template_app_pdf_viewer_terminalsChanged_8_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onTerminalsChanged($event));\n    })(\"dropsChanged\", function ProjectEditorComponent_div_0_Template_app_pdf_viewer_dropsChanged_8_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onDropsChanged($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, ProjectEditorComponent_div_0_div_9_Template, 2, 4, \"div\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"aside\", 13)(11, \"div\", 14)(12, \"h3\", 15);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(14, ProjectEditorComponent_div_0_ul_14_Template, 2, 1, \"ul\", 16)(15, ProjectEditorComponent_div_0_ng_template_15_Template, 2, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"div\", 14)(18, \"h3\", 15);\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(20, ProjectEditorComponent_div_0_ul_20_Template, 2, 1, \"ul\", 16)(21, ProjectEditorComponent_div_0_ng_template_21_Template, 2, 0, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"div\", 14)(24, \"h3\", 15);\n    i0.ɵɵtext(25);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(26, ProjectEditorComponent_div_0_ul_26_Template, 2, 1, \"ul\", 16)(27, ProjectEditorComponent_div_0_ng_template_27_Template, 2, 0, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"div\", 14)(30, \"h3\", 15);\n    i0.ɵɵtext(31);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(32, ProjectEditorComponent_div_0_ul_32_Template, 2, 1, \"ul\", 16)(33, ProjectEditorComponent_div_0_ng_template_33_Template, 2, 0, \"ng-template\", null, 3, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(35, \"div\", 14)(36, \"h3\", 15);\n    i0.ɵɵtext(37, \"Exports\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(38, \"div\", 17)(39, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_Template_button_click_39_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.exportPdf());\n    });\n    i0.ɵɵtext(40, \"Annotated PDF\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(41, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_Template_button_click_41_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.exportCsv());\n    });\n    i0.ɵɵtext(42, \"Materials CSV\");\n    i0.ɵɵelementEnd()()()()()();\n  }\n  if (rf & 2) {\n    const noTerminals_r13 = i0.ɵɵreference(16);\n    const noDrops_r14 = i0.ɵɵreference(22);\n    const noFiber_r15 = i0.ɵɵreference(28);\n    const noConduits_r16 = i0.ɵɵreference(34);\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"pdfUrl\", ctx_r1.pdfUrl)(\"projectId\", ctx_r1.projectId)(\"syncedTerminals\", ctx_r1.syncedTerminalsList)(\"syncedDrops\", ctx_r1.syncedDropsList)(\"syncedPolylines\", ctx_r1.syncedPolylinesList);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.pdfCanvas && ctx_r1.viewport);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"Terminals (\", ctx_r1.terminals.length, \")\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.terminals.length)(\"ngIfElse\", noTerminals_r13);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"Drop Peds (\", ctx_r1.drops.length, \")\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.drops.length)(\"ngIfElse\", noDrops_r14);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"Fiber Segments (\", ctx_r1.fiberSegments.length, \")\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.fiberSegments.length)(\"ngIfElse\", noFiber_r15);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"Links & Conduits (\", ctx_r1.conduits.length, \")\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.conduits.length)(\"ngIfElse\", noConduits_r16);\n  }\n}\nexport let ProjectEditorComponent = /*#__PURE__*/(() => {\n  class ProjectEditorComponent {\n    constructor(route, apiService, stateService) {\n      this.route = route;\n      this.apiService = apiService;\n      this.stateService = stateService;\n      this.projectId = null;\n      this.pdfUrl = '';\n      this.pdfCanvas = null;\n      this.viewport = null;\n      this.markerMode = null;\n      this.markers = [];\n      this.polylines = [];\n      this.conduits = [];\n      this.markerLinks = [];\n      this.String = String; // Make String accessible in templates\n      this.stateService.markers$.subscribe(m => this.markers = m);\n      this.stateService.polylines$.subscribe(p => this.polylines = p);\n      this.stateService.conduits$.subscribe(c => this.conduits = c);\n      this.stateService.markerLinks$.subscribe(l => this.markerLinks = l);\n    }\n    ngOnInit() {\n      this.route.params.subscribe(params => {\n        this.projectId = parseInt(params['id']);\n        if (this.projectId) {\n          this.loadProject();\n        }\n      });\n    }\n    loadProject() {\n      if (!this.projectId) return;\n      this.apiService.getProject(this.projectId).subscribe(project => {\n        this.stateService.setProject(project);\n        this.pdfUrl = `${window.location.protocol}//${window.location.hostname}:8000/api/projects/${this.projectId}/pdf`;\n        this.loadProjectData();\n      }, error => console.error('Failed to load project', error));\n    }\n    loadProjectData() {\n      if (!this.projectId) return;\n      this.apiService.getMarkers(this.projectId).subscribe(markers => {\n        this.markers = markers;\n        this.stateService.setMarkers(markers);\n      });\n      this.apiService.getPolylines(this.projectId).subscribe(polylines => {\n        this.polylines = polylines;\n        this.stateService.setPolylines(polylines);\n      });\n      this.apiService.getConduits(this.projectId).subscribe(conduits => {\n        this.conduits = conduits;\n        this.stateService.setConduits(conduits);\n      });\n      this.apiService.getMarkerLinks(this.projectId).subscribe(links => {\n        this.markerLinks = links;\n        this.stateService.setMarkerLinks(links);\n      });\n    }\n    onCanvasReady(event) {\n      this.pdfCanvas = event.canvas;\n      this.viewport = event.viewport;\n    }\n    onPolylinesChanged(polylines) {\n      // Update polylines with the local drawing data from pdf-viewer\n      const fiberPolylines = polylines.filter(p => p.type === 'fiber').map((p, idx) => ({\n        id: this.polylines[idx]?.id || -idx - 1,\n        // Keep existing ID or use negative for new\n        project_id: this.projectId || 0,\n        page_number: 1,\n        name: `Fiber Route ${idx + 1}`,\n        points: p.points,\n        length_ft: p.lengthFt\n      }));\n      this.polylines = fiberPolylines;\n    }\n    onTerminalsChanged(terminals) {\n      // Update markers with the local terminal data from pdf-viewer\n      const existingTerminals = this.markers.filter(m => m.marker_type === 'terminal');\n      const terminalMarkers = terminals.map((t, idx) => ({\n        id: existingTerminals[idx]?.id || -idx - 1,\n        // Keep existing ID or use negative for new\n        project_id: this.projectId || 0,\n        page_number: 1,\n        x: t.x,\n        y: t.y,\n        marker_type: 'terminal'\n      }));\n      // Keep only terminals, remove drops from this list\n      this.markers = terminalMarkers;\n    }\n    onDropsChanged(drops) {\n      // Update markers with the local drop data from pdf-viewer\n      const existingDrops = this.markers.filter(m => m.marker_type === 'dropPed' || m.marker_type === 'drop');\n      const dropMarkers = drops.map((d, idx) => ({\n        id: existingDrops[idx]?.id || -(1000 + idx),\n        // Keep existing ID or use negative for new\n        project_id: this.projectId || 0,\n        page_number: 1,\n        x: d.x,\n        y: d.y,\n        marker_type: 'dropPed'\n      }));\n      this.markers = [...this.markers.filter(m => m.marker_type === 'terminal'), ...dropMarkers];\n    }\n    setMarkerMode(mode) {\n      this.markerMode = this.markerMode === mode ? null : mode;\n    }\n    saveProject() {\n      if (!this.projectId) return;\n      let saveCount = 0;\n      let errorCount = 0;\n      const totalItems = this.markers.filter(m => m.id < 0).length + this.polylines.filter(p => p.id < 0).length;\n      if (totalItems === 0) {\n        alert('No new changes to save');\n        return;\n      }\n      // Save new markers (terminals and drops)\n      this.markers.forEach(marker => {\n        if (marker.id < 0) {\n          this.apiService.addMarker(this.projectId || 0, {\n            x: marker.x,\n            y: marker.y,\n            marker_type: marker.marker_type,\n            page_number: marker.page_number\n          }).subscribe(savedMarker => {\n            marker.id = savedMarker.id;\n            saveCount++;\n            if (saveCount + errorCount === totalItems) {\n              this.showSaveResults(saveCount, errorCount);\n            }\n          }, error => {\n            console.error('Failed to save marker:', error);\n            errorCount++;\n            if (saveCount + errorCount === totalItems) {\n              this.showSaveResults(saveCount, errorCount);\n            }\n          });\n        }\n      });\n      // Save new polylines (fiber routes)\n      this.polylines.forEach(polyline => {\n        if (polyline.id < 0) {\n          this.apiService.addPolyline(this.projectId || 0, {\n            name: polyline.name,\n            points: polyline.points,\n            page_number: polyline.page_number\n          }).subscribe(savedPolyline => {\n            polyline.id = savedPolyline.id;\n            polyline.length_ft = savedPolyline.length_ft; // Update with calculated length from backend\n            saveCount++;\n            if (saveCount + errorCount === totalItems) {\n              this.showSaveResults(saveCount, errorCount);\n            }\n          }, error => {\n            console.error('Failed to save polyline:', error);\n            errorCount++;\n            if (saveCount + errorCount === totalItems) {\n              this.showSaveResults(saveCount, errorCount);\n            }\n          });\n        }\n      });\n    }\n    showSaveResults(successCount, errorCount) {\n      if (errorCount === 0) {\n        alert(`Successfully saved ${successCount} item(s)`);\n      } else {\n        alert(`Saved ${successCount} item(s), ${errorCount} failed. Check console for errors.`);\n      }\n    }\n    get terminals() {\n      return this.markers.filter(m => m.marker_type === 'terminal');\n    }\n    get drops() {\n      return this.markers.filter(m => m.marker_type === 'drop' || m.marker_type === 'dropPed');\n    }\n    get syncedTerminalsList() {\n      return this.terminals.map((t, idx) => ({\n        x: t.x,\n        y: t.y,\n        id: idx\n      }));\n    }\n    get syncedDropsList() {\n      return this.drops.map((d, idx) => ({\n        x: d.x,\n        y: d.y,\n        id: idx\n      }));\n    }\n    get syncedPolylinesList() {\n      return this.polylines;\n    }\n    get fiberSegments() {\n      return this.polylines;\n    }\n    removeTerminal(terminal) {\n      if (terminal.id && terminal.id > 0) {\n        this.apiService.deleteMarker(this.projectId || 0, terminal.id).subscribe(() => {\n          this.markers = this.markers.filter(m => m !== terminal);\n        }, error => console.error('Failed to delete terminal:', error));\n      } else {\n        this.markers = this.markers.filter(m => m !== terminal);\n      }\n    }\n    removeDrop(drop) {\n      if (drop.id && drop.id > 0) {\n        this.apiService.deleteMarker(this.projectId || 0, drop.id).subscribe(() => {\n          this.markers = this.markers.filter(m => m !== drop);\n        }, error => console.error('Failed to delete drop:', error));\n      } else {\n        this.markers = this.markers.filter(m => m !== drop);\n      }\n    }\n    removeFiber(fiber) {\n      if (confirm(`Delete fiber cable \"${fiber.name || 'Route'}\" (${fiber.length_ft?.toFixed(1) || '0.0'} ft)? This cannot be undone.`)) {\n        if (fiber.id && fiber.id > 0) {\n          this.apiService.deletePolyline(this.projectId || 0, fiber.id).subscribe(() => {\n            this.polylines = this.polylines.filter(p => p !== fiber);\n          }, error => console.error('Failed to delete fiber:', error));\n        } else {\n          this.polylines = this.polylines.filter(p => p !== fiber);\n        }\n      }\n    }\n    removeConduit(conduit) {\n      if (conduit.id && conduit.id > 0) {\n        this.apiService.deleteConduit(this.projectId || 0, conduit.id).subscribe(() => {\n          this.conduits = this.conduits.filter(c => c !== conduit);\n        }, error => console.error('Failed to delete conduit:', error));\n      } else {\n        this.conduits = this.conduits.filter(c => c !== conduit);\n      }\n    }\n    onCalibrationChanged(calibration) {\n      console.log('Calibration saved:', calibration);\n    }\n    exportPdf() {\n      if (!this.projectId) return;\n      this.apiService.exportPdf(this.projectId, 1, this.viewport?.pageWidth, this.viewport?.pageHeight).subscribe(blob => {\n        this.downloadFile(blob, `project_${this.projectId}_annotated.pdf`);\n      });\n    }\n    exportCsv() {\n      if (!this.projectId) return;\n      this.apiService.exportCsv(this.projectId).subscribe(blob => {\n        this.downloadFile(blob, `project_${this.projectId}_report.csv`);\n      });\n    }\n    downloadFile(blob, filename) {\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = filename;\n      link.click();\n      window.URL.revokeObjectURL(url);\n    }\n    static {\n      this.ɵfac = function ProjectEditorComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ProjectEditorComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.StateService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ProjectEditorComponent,\n        selectors: [[\"app-project-editor\"]],\n        decls: 1,\n        vars: 1,\n        consts: [[\"noTerminals\", \"\"], [\"noDrops\", \"\"], [\"noFiber\", \"\"], [\"noConduits\", \"\"], [\"class\", \"flex flex-col h-full\", 4, \"ngIf\"], [1, \"flex\", \"flex-col\", \"h-full\"], [1, \"bg-white\", \"border-b\", \"shadow\", \"p-3\", \"flex\", \"justify-between\", \"items-center\"], [1, \"text-lg\", \"font-semibold\"], [1, \"px-4\", \"py-2\", \"bg-blue-600\", \"text-white\", \"rounded\", \"hover:bg-blue-700\", \"font-medium\", 3, \"click\"], [1, \"grid\", \"grid-cols-4\", \"gap-4\", \"flex-1\", \"overflow-hidden\"], [1, \"col-span-3\", \"flex\", \"flex-col\", \"relative\"], [3, \"canvasReady\", \"polylinesChanged\", \"terminalsChanged\", \"dropsChanged\", \"pdfUrl\", \"projectId\", \"syncedTerminals\", \"syncedDrops\", \"syncedPolylines\"], [\"class\", \"absolute inset-0\", 4, \"ngIf\"], [1, \"col-span-1\", \"bg-white\", \"border\", \"rounded\", \"p-4\", \"space-y-4\", \"overflow-y-auto\"], [1, \"space-y-2\"], [1, \"font-semibold\", \"text-sm\"], [\"class\", \"space-y-1 text-sm text-gray-700\", 4, \"ngIf\", \"ngIfElse\"], [1, \"flex\", \"flex-wrap\", \"gap-2\"], [1, \"px-3\", \"py-2\", \"rounded\", \"border\", \"hover:bg-gray-100\", 3, \"click\"], [1, \"absolute\", \"inset-0\"], [3, \"pdfCanvas\", \"viewport\", \"isActive\", \"projectId\"], [1, \"space-y-1\", \"text-sm\", \"text-gray-700\"], [\"class\", \"flex justify-between items-center bg-gray-50 p-2 rounded\", 4, \"ngFor\", \"ngForOf\"], [1, \"flex\", \"justify-between\", \"items-center\", \"bg-gray-50\", \"p-2\", \"rounded\"], [1, \"text-xs\", \"text-red-600\", \"hover:text-red-800\", 3, \"click\"], [1, \"text-xs\", \"text-gray-500\"]],\n        template: function ProjectEditorComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵtemplate(0, ProjectEditorComponent_div_0_Template, 43, 18, \"div\", 4);\n          }\n          if (rf & 2) {\n            i0.ɵɵproperty(\"ngIf\", ctx.projectId);\n          }\n        },\n        dependencies: [CommonModule, i4.NgForOf, i4.NgIf, FormsModule, PDFViewerComponent, DrawingCanvasComponent],\n        styles: [\"[_nghost-%COMP%]{display:flex;height:100%}\"]\n      });\n    }\n  }\n  return ProjectEditorComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}