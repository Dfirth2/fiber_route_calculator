{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { PDFViewerComponent } from '../pdf-viewer/pdf-viewer.component';\nimport { DrawingCanvasComponent } from '../drawing-canvas/drawing-canvas.component';\nimport { ScaleCalibrationComponent } from '../scale-calibration/scale-calibration.component';\nimport { MeasurementDisplayComponent } from '../measurement-display/measurement-display.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../core/services/api.service\";\nimport * as i3 from \"../../core/services/state.service\";\nimport * as i4 from \"@angular/common\";\nfunction ProjectEditorComponent_div_0_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12);\n    i0.ɵɵelement(1, \"app-drawing-canvas\", 13);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"pdfCanvas\", ctx_r1.pdfCanvas)(\"viewport\", ctx_r1.viewport)(\"isActive\", ctx_r1.markerMode === \"terminal\" || ctx_r1.markerMode === \"dropPed\")(\"projectId\", ctx_r1.projectId);\n  }\n}\nfunction ProjectEditorComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"div\", 3)(3, \"app-pdf-viewer\", 4);\n    i0.ɵɵlistener(\"canvasReady\", function ProjectEditorComponent_div_0_Template_app_pdf_viewer_canvasReady_3_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onCanvasReady($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, ProjectEditorComponent_div_0_div_4_Template, 2, 4, \"div\", 5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 6)(6, \"div\", 7)(7, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.setMarkerMode(\"terminal\"));\n    });\n    i0.ɵɵtext(8, \" + Terminal \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.setMarkerMode(\"dropPed\"));\n    });\n    i0.ɵɵtext(10, \" + Drop Ped \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_Template_button_click_11_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.exportPdf());\n    });\n    i0.ɵɵtext(12, \" Export PDF \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_Template_button_click_13_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.exportCsv());\n    });\n    i0.ɵɵtext(14, \" Export CSV \");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(15, \"div\", 9)(16, \"app-scale-calibration\", 10);\n    i0.ɵɵlistener(\"calibrationChanged\", function ProjectEditorComponent_div_0_Template_app_scale_calibration_calibrationChanged_16_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onCalibrationChanged($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(17, \"app-measurement-display\", 11);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"pdfUrl\", ctx_r1.pdfUrl);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.pdfCanvas && ctx_r1.viewport);\n    i0.ɵɵadvance(3);\n    i0.ɵɵclassProp(\"bg-blue-600\", ctx_r1.markerMode === \"terminal\")(\"text-white\", ctx_r1.markerMode === \"terminal\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"bg-blue-600\", ctx_r1.markerMode === \"dropPed\")(\"text-white\", ctx_r1.markerMode === \"dropPed\");\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"projectId\", ctx_r1.projectId);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"projectId\", ctx_r1.projectId);\n  }\n}\nexport let ProjectEditorComponent = /*#__PURE__*/(() => {\n  class ProjectEditorComponent {\n    constructor(route, apiService, stateService) {\n      this.route = route;\n      this.apiService = apiService;\n      this.stateService = stateService;\n      this.projectId = null;\n      this.pdfUrl = '';\n      this.pdfCanvas = null;\n      this.viewport = null;\n      this.markerMode = null;\n    }\n    ngOnInit() {\n      this.route.params.subscribe(params => {\n        this.projectId = parseInt(params['id']);\n        if (this.projectId) {\n          this.loadProject();\n        }\n      });\n    }\n    loadProject() {\n      if (!this.projectId) return;\n      this.apiService.getProject(this.projectId).subscribe(project => {\n        this.stateService.setProject(project);\n        this.pdfUrl = `${window.location.protocol}//${window.location.hostname}:8000/api/projects/${this.projectId}/pdf`;\n        this.loadProjectData();\n      }, error => console.error('Failed to load project', error));\n    }\n    loadProjectData() {\n      if (!this.projectId) return;\n      this.apiService.getMarkers(this.projectId).subscribe(markers => {\n        this.stateService.setMarkers(markers);\n      });\n      this.apiService.getPolylines(this.projectId).subscribe(polylines => {\n        this.stateService.setPolylines(polylines);\n      });\n      this.apiService.getConduits(this.projectId).subscribe(conduits => {\n        this.stateService.setConduits(conduits);\n      });\n    }\n    onCanvasReady(event) {\n      this.pdfCanvas = event.canvas;\n      this.viewport = event.viewport;\n    }\n    setMarkerMode(mode) {\n      this.markerMode = this.markerMode === mode ? null : mode;\n    }\n    onCalibrationChanged(calibration) {\n      console.log('Calibration saved:', calibration);\n    }\n    exportPdf() {\n      if (!this.projectId) return;\n      this.apiService.exportPdf(this.projectId, 1, this.viewport?.pageWidth, this.viewport?.pageHeight).subscribe(blob => {\n        this.downloadFile(blob, `project_${this.projectId}_annotated.pdf`);\n      });\n    }\n    exportCsv() {\n      if (!this.projectId) return;\n      this.apiService.exportCsv(this.projectId).subscribe(blob => {\n        this.downloadFile(blob, `project_${this.projectId}_report.csv`);\n      });\n    }\n    downloadFile(blob, filename) {\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = filename;\n      link.click();\n      window.URL.revokeObjectURL(url);\n    }\n    static {\n      this.ɵfac = function ProjectEditorComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ProjectEditorComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.StateService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ProjectEditorComponent,\n        selectors: [[\"app-project-editor\"]],\n        decls: 1,\n        vars: 1,\n        consts: [[\"class\", \"grid grid-cols-4 gap-4 h-full\", 4, \"ngIf\"], [1, \"grid\", \"grid-cols-4\", \"gap-4\", \"h-full\"], [1, \"col-span-3\", \"flex\", \"flex-col\"], [1, \"flex-1\", \"relative\"], [3, \"canvasReady\", \"pdfUrl\"], [\"class\", \"absolute inset-0\", 4, \"ngIf\"], [1, \"bg-white\", \"border-t\", \"p-4\", \"space-y-2\"], [1, \"grid\", \"grid-cols-4\", \"gap-2\"], [1, \"px-4\", \"py-2\", \"rounded\", \"border\", \"hover:bg-gray-100\", 3, \"click\"], [1, \"bg-white\", \"border-l\", \"overflow-y-auto\", \"space-y-6\", \"p-4\"], [3, \"calibrationChanged\", \"projectId\"], [3, \"projectId\"], [1, \"absolute\", \"inset-0\"], [3, \"pdfCanvas\", \"viewport\", \"isActive\", \"projectId\"]],\n        template: function ProjectEditorComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵtemplate(0, ProjectEditorComponent_div_0_Template, 18, 12, \"div\", 0);\n          }\n          if (rf & 2) {\n            i0.ɵɵproperty(\"ngIf\", ctx.projectId);\n          }\n        },\n        dependencies: [CommonModule, i4.NgIf, FormsModule, PDFViewerComponent, DrawingCanvasComponent, ScaleCalibrationComponent, MeasurementDisplayComponent],\n        styles: [\"[_nghost-%COMP%]{display:flex;height:100%}\"]\n      });\n    }\n  }\n  return ProjectEditorComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}