{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { PDFViewerComponent } from '../pdf-viewer/pdf-viewer.component';\nimport { DrawingCanvasComponent } from '../drawing-canvas/drawing-canvas.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../core/services/api.service\";\nimport * as i3 from \"../../core/services/state.service\";\nimport * as i4 from \"@angular/common\";\nfunction ProjectEditorComponent_div_0_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelement(1, \"app-drawing-canvas\", 16);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"pdfCanvas\", ctx_r1.pdfCanvas)(\"viewport\", ctx_r1.viewport)(\"isActive\", ctx_r1.markerMode === \"terminal\" || ctx_r1.markerMode === \"dropPed\")(\"projectId\", ctx_r1.projectId);\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_8_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 19)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_ul_8_li_1_Template_button_click_3_listener() {\n      const t_r4 = i0.ɵɵrestoreView(_r3).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.removeTerminal(t_r4));\n    });\n    i0.ɵɵtext(4, \"Remove\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const i_r5 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Terminal \", ctx_r1.String.fromCharCode(65 + i_r5));\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 17);\n    i0.ɵɵtemplate(1, ProjectEditorComponent_div_0_ul_8_li_1_Template, 5, 1, \"li\", 18);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.terminals);\n  }\n}\nfunction ProjectEditorComponent_div_0_ng_template_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵtext(1, \"None placed\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_14_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 19)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_ul_14_li_1_Template_button_click_3_listener() {\n      const d_r7 = i0.ɵɵrestoreView(_r6).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.removeDrop(d_r7));\n    });\n    i0.ɵɵtext(4, \"Remove\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const i_r8 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Drop Ped \", ctx_r1.String.fromCharCode(65 + i_r8));\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 17);\n    i0.ɵɵtemplate(1, ProjectEditorComponent_div_0_ul_14_li_1_Template, 5, 1, \"li\", 18);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.drops);\n  }\n}\nfunction ProjectEditorComponent_div_0_ng_template_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵtext(1, \"None placed\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_20_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 19)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_ul_20_li_1_Template_button_click_3_listener() {\n      const seg_r10 = i0.ɵɵrestoreView(_r9).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.removeFiber(seg_r10));\n    });\n    i0.ɵɵtext(4, \"Remove\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const seg_r10 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate3(\"\", seg_r10.name || \"Route\", \" \\u2013 page \", seg_r10.page_number, \" \\u2013 \", seg_r10.length_ft ? seg_r10.length_ft.toFixed(1) : \"0.0\", \" ft\");\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 17);\n    i0.ɵɵtemplate(1, ProjectEditorComponent_div_0_ul_20_li_1_Template, 5, 3, \"li\", 18);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.fiberSegments);\n  }\n}\nfunction ProjectEditorComponent_div_0_ng_template_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵtext(1, \"No fiber drawn\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_26_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 19)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_ul_26_li_1_Template_button_click_3_listener() {\n      const c_r12 = i0.ɵɵrestoreView(_r11).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.removeConduit(c_r12));\n    });\n    i0.ɵɵtext(4, \"Remove\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const c_r12 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate4(\"Terminal \", c_r12.terminal_id, \" \\u2192 Drop \", c_r12.drop_ped_id, \" \\u2014 \", c_r12.footage ? c_r12.footage.toFixed(1) : \"0.0\", \" ft (page \", c_r12.page_number, \")\");\n  }\n}\nfunction ProjectEditorComponent_div_0_ul_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 17);\n    i0.ɵɵtemplate(1, ProjectEditorComponent_div_0_ul_26_li_1_Template, 5, 4, \"li\", 18);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.conduits);\n  }\n}\nfunction ProjectEditorComponent_div_0_ng_template_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵtext(1, \"No conduits linked\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProjectEditorComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"div\", 6)(2, \"app-pdf-viewer\", 7);\n    i0.ɵɵlistener(\"canvasReady\", function ProjectEditorComponent_div_0_Template_app_pdf_viewer_canvasReady_2_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onCanvasReady($event));\n    })(\"polylinesChanged\", function ProjectEditorComponent_div_0_Template_app_pdf_viewer_polylinesChanged_2_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onPolylinesChanged($event));\n    })(\"terminalsChanged\", function ProjectEditorComponent_div_0_Template_app_pdf_viewer_terminalsChanged_2_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onTerminalsChanged($event));\n    })(\"dropsChanged\", function ProjectEditorComponent_div_0_Template_app_pdf_viewer_dropsChanged_2_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onDropsChanged($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, ProjectEditorComponent_div_0_div_3_Template, 2, 4, \"div\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"aside\", 9)(5, \"div\", 10)(6, \"h3\", 11);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, ProjectEditorComponent_div_0_ul_8_Template, 2, 1, \"ul\", 12)(9, ProjectEditorComponent_div_0_ng_template_9_Template, 2, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 10)(12, \"h3\", 11);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(14, ProjectEditorComponent_div_0_ul_14_Template, 2, 1, \"ul\", 12)(15, ProjectEditorComponent_div_0_ng_template_15_Template, 2, 0, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"div\", 10)(18, \"h3\", 11);\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(20, ProjectEditorComponent_div_0_ul_20_Template, 2, 1, \"ul\", 12)(21, ProjectEditorComponent_div_0_ng_template_21_Template, 2, 0, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"div\", 10)(24, \"h3\", 11);\n    i0.ɵɵtext(25);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(26, ProjectEditorComponent_div_0_ul_26_Template, 2, 1, \"ul\", 12)(27, ProjectEditorComponent_div_0_ng_template_27_Template, 2, 0, \"ng-template\", null, 3, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"div\", 10)(30, \"h3\", 11);\n    i0.ɵɵtext(31, \"Exports\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(32, \"div\", 13)(33, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_Template_button_click_33_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.exportPdf());\n    });\n    i0.ɵɵtext(34, \"Annotated PDF\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(35, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function ProjectEditorComponent_div_0_Template_button_click_35_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.exportCsv());\n    });\n    i0.ɵɵtext(36, \"Materials CSV\");\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const noTerminals_r13 = i0.ɵɵreference(10);\n    const noDrops_r14 = i0.ɵɵreference(16);\n    const noFiber_r15 = i0.ɵɵreference(22);\n    const noConduits_r16 = i0.ɵɵreference(28);\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"pdfUrl\", ctx_r1.pdfUrl);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.pdfCanvas && ctx_r1.viewport);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"Terminals (\", ctx_r1.terminals.length, \")\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.terminals.length)(\"ngIfElse\", noTerminals_r13);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"Drop Peds (\", ctx_r1.drops.length, \")\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.drops.length)(\"ngIfElse\", noDrops_r14);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"Fiber Segments (\", ctx_r1.fiberSegments.length, \")\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.fiberSegments.length)(\"ngIfElse\", noFiber_r15);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"Links & Conduits (\", ctx_r1.conduits.length, \")\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.conduits.length)(\"ngIfElse\", noConduits_r16);\n  }\n}\nexport class ProjectEditorComponent {\n  constructor(route, apiService, stateService) {\n    this.route = route;\n    this.apiService = apiService;\n    this.stateService = stateService;\n    this.projectId = null;\n    this.pdfUrl = '';\n    this.pdfCanvas = null;\n    this.viewport = null;\n    this.markerMode = null;\n    this.markers = [];\n    this.polylines = [];\n    this.conduits = [];\n    this.markerLinks = [];\n    this.String = String; // Make String accessible in templates\n    this.stateService.markers$.subscribe(m => this.markers = m);\n    this.stateService.polylines$.subscribe(p => this.polylines = p);\n    this.stateService.conduits$.subscribe(c => this.conduits = c);\n    this.stateService.markerLinks$.subscribe(l => this.markerLinks = l);\n  }\n  ngOnInit() {\n    this.route.params.subscribe(params => {\n      this.projectId = parseInt(params['id']);\n      if (this.projectId) {\n        this.loadProject();\n      }\n    });\n  }\n  loadProject() {\n    if (!this.projectId) return;\n    this.apiService.getProject(this.projectId).subscribe(project => {\n      this.stateService.setProject(project);\n      this.pdfUrl = `${window.location.protocol}//${window.location.hostname}:8000/api/projects/${this.projectId}/pdf`;\n      this.loadProjectData();\n    }, error => console.error('Failed to load project', error));\n  }\n  loadProjectData() {\n    if (!this.projectId) return;\n    this.apiService.getMarkers(this.projectId).subscribe(markers => {\n      this.stateService.setMarkers(markers);\n    });\n    this.apiService.getPolylines(this.projectId).subscribe(polylines => {\n      this.stateService.setPolylines(polylines);\n    });\n    this.apiService.getConduits(this.projectId).subscribe(conduits => {\n      this.stateService.setConduits(conduits);\n    });\n    this.apiService.getMarkerLinks(this.projectId).subscribe(links => {\n      this.stateService.setMarkerLinks(links);\n    });\n  }\n  onCanvasReady(event) {\n    this.pdfCanvas = event.canvas;\n    this.viewport = event.viewport;\n  }\n  onPolylinesChanged(polylines) {\n    // Update polylines with the local drawing data from pdf-viewer\n    const fiberPolylines = polylines.filter(p => p.type === 'fiber').map((p, idx) => ({\n      id: -idx - 1,\n      // negative IDs for unsaved items\n      project_id: this.projectId || 0,\n      page_number: 1,\n      name: `Fiber Route ${idx + 1}`,\n      points: p.points,\n      length_ft: p.lengthFt\n    }));\n    this.polylines = fiberPolylines;\n  }\n  onTerminalsChanged(terminals) {\n    // Update markers with the local terminal data from pdf-viewer\n    this.markers = terminals.map((t, idx) => ({\n      id: -idx - 1,\n      project_id: this.projectId || 0,\n      page_number: 1,\n      x: t.x,\n      y: t.y,\n      marker_type: 'terminal'\n    }));\n  }\n  onDropsChanged(drops) {\n    // Update markers with the local drop data from pdf-viewer\n    const dropMarkers = drops.map((d, idx) => ({\n      id: -(1000 + idx),\n      project_id: this.projectId || 0,\n      page_number: 1,\n      x: d.x,\n      y: d.y,\n      marker_type: 'drop'\n    }));\n    this.markers = [...this.markers.filter(m => m.marker_type === 'terminal'), ...dropMarkers];\n  }\n  setMarkerMode(mode) {\n    this.markerMode = this.markerMode === mode ? null : mode;\n  }\n  get terminals() {\n    return this.markers.filter(m => m.marker_type === 'terminal');\n  }\n  get drops() {\n    return this.markers.filter(m => m.marker_type === 'drop' || m.marker_type === 'dropPed');\n  }\n  get fiberSegments() {\n    return this.polylines;\n  }\n  removeTerminal(terminal) {\n    this.markers = this.markers.filter(m => m !== terminal);\n  }\n  removeDrop(drop) {\n    this.markers = this.markers.filter(m => m !== drop);\n  }\n  removeFiber(fiber) {\n    if (confirm(`Delete fiber cable \"${fiber.name || 'Route'}\" (${fiber.length_ft?.toFixed(1) || '0.0'} ft)? This cannot be undone.`)) {\n      this.polylines = this.polylines.filter(p => p !== fiber);\n    }\n  }\n  removeConduit(conduit) {\n    this.conduits = this.conduits.filter(c => c !== conduit);\n  }\n  onCalibrationChanged(calibration) {\n    console.log('Calibration saved:', calibration);\n  }\n  exportPdf() {\n    if (!this.projectId) return;\n    this.apiService.exportPdf(this.projectId, 1, this.viewport?.pageWidth, this.viewport?.pageHeight).subscribe(blob => {\n      this.downloadFile(blob, `project_${this.projectId}_annotated.pdf`);\n    });\n  }\n  exportCsv() {\n    if (!this.projectId) return;\n    this.apiService.exportCsv(this.projectId).subscribe(blob => {\n      this.downloadFile(blob, `project_${this.projectId}_report.csv`);\n    });\n  }\n  downloadFile(blob, filename) {\n    const url = window.URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    link.click();\n    window.URL.revokeObjectURL(url);\n  }\n  static {\n    this.ɵfac = function ProjectEditorComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || ProjectEditorComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.StateService));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ProjectEditorComponent,\n      selectors: [[\"app-project-editor\"]],\n      decls: 1,\n      vars: 1,\n      consts: [[\"noTerminals\", \"\"], [\"noDrops\", \"\"], [\"noFiber\", \"\"], [\"noConduits\", \"\"], [\"class\", \"grid grid-cols-4 gap-4 h-full\", 4, \"ngIf\"], [1, \"grid\", \"grid-cols-4\", \"gap-4\", \"h-full\"], [1, \"col-span-3\", \"flex\", \"flex-col\", \"relative\"], [3, \"canvasReady\", \"polylinesChanged\", \"terminalsChanged\", \"dropsChanged\", \"pdfUrl\"], [\"class\", \"absolute inset-0\", 4, \"ngIf\"], [1, \"col-span-1\", \"bg-white\", \"border\", \"rounded\", \"p-4\", \"space-y-4\", \"overflow-y-auto\"], [1, \"space-y-2\"], [1, \"font-semibold\", \"text-sm\"], [\"class\", \"space-y-1 text-sm text-gray-700\", 4, \"ngIf\", \"ngIfElse\"], [1, \"flex\", \"flex-wrap\", \"gap-2\"], [1, \"px-3\", \"py-2\", \"rounded\", \"border\", \"hover:bg-gray-100\", 3, \"click\"], [1, \"absolute\", \"inset-0\"], [3, \"pdfCanvas\", \"viewport\", \"isActive\", \"projectId\"], [1, \"space-y-1\", \"text-sm\", \"text-gray-700\"], [\"class\", \"flex justify-between items-center bg-gray-50 p-2 rounded\", 4, \"ngFor\", \"ngForOf\"], [1, \"flex\", \"justify-between\", \"items-center\", \"bg-gray-50\", \"p-2\", \"rounded\"], [1, \"text-xs\", \"text-red-600\", \"hover:text-red-800\", 3, \"click\"], [1, \"text-xs\", \"text-gray-500\"]],\n      template: function ProjectEditorComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵtemplate(0, ProjectEditorComponent_div_0_Template, 37, 14, \"div\", 4);\n        }\n        if (rf & 2) {\n          i0.ɵɵproperty(\"ngIf\", ctx.projectId);\n        }\n      },\n      dependencies: [CommonModule, i4.NgForOf, i4.NgIf, FormsModule, PDFViewerComponent, DrawingCanvasComponent],\n      styles: [\"[_nghost-%COMP%] {\\n      display: flex;\\n      height: 100%;\\n    }\\n  \\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy9wcm9qZWN0LWVkaXRvci9wcm9qZWN0LWVkaXRvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtJQUNJO01BQ0UsYUFBYTtNQUNiLFlBQVk7SUFDZCIsInNvdXJjZXNDb250ZW50IjpbIlxuICAgIDpob3N0IHtcbiAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgfVxuICAiXSwic291cmNlUm9vdCI6IiJ9 */\"]\n    });\n  }\n}","map":{"version":3,"names":["CommonModule","FormsModule","PDFViewerComponent","DrawingCanvasComponent","i0","ɵɵelementStart","ɵɵelement","ɵɵelementEnd","ɵɵadvance","ɵɵproperty","ctx_r1","pdfCanvas","viewport","markerMode","projectId","ɵɵtext","ɵɵlistener","ProjectEditorComponent_div_0_ul_8_li_1_Template_button_click_3_listener","t_r4","ɵɵrestoreView","_r3","$implicit","ɵɵnextContext","ɵɵresetView","removeTerminal","ɵɵtextInterpolate1","String","fromCharCode","i_r5","ɵɵtemplate","ProjectEditorComponent_div_0_ul_8_li_1_Template","terminals","ProjectEditorComponent_div_0_ul_14_li_1_Template_button_click_3_listener","d_r7","_r6","removeDrop","i_r8","ProjectEditorComponent_div_0_ul_14_li_1_Template","drops","ProjectEditorComponent_div_0_ul_20_li_1_Template_button_click_3_listener","seg_r10","_r9","removeFiber","ɵɵtextInterpolate3","name","page_number","length_ft","toFixed","ProjectEditorComponent_div_0_ul_20_li_1_Template","fiberSegments","ProjectEditorComponent_div_0_ul_26_li_1_Template_button_click_3_listener","c_r12","_r11","removeConduit","ɵɵtextInterpolate4","terminal_id","drop_ped_id","footage","ProjectEditorComponent_div_0_ul_26_li_1_Template","conduits","ProjectEditorComponent_div_0_Template_app_pdf_viewer_canvasReady_2_listener","$event","_r1","onCanvasReady","ProjectEditorComponent_div_0_Template_app_pdf_viewer_polylinesChanged_2_listener","onPolylinesChanged","ProjectEditorComponent_div_0_Template_app_pdf_viewer_terminalsChanged_2_listener","onTerminalsChanged","ProjectEditorComponent_div_0_Template_app_pdf_viewer_dropsChanged_2_listener","onDropsChanged","ProjectEditorComponent_div_0_div_3_Template","ProjectEditorComponent_div_0_ul_8_Template","ProjectEditorComponent_div_0_ng_template_9_Template","ɵɵtemplateRefExtractor","ProjectEditorComponent_div_0_ul_14_Template","ProjectEditorComponent_div_0_ng_template_15_Template","ProjectEditorComponent_div_0_ul_20_Template","ProjectEditorComponent_div_0_ng_template_21_Template","ProjectEditorComponent_div_0_ul_26_Template","ProjectEditorComponent_div_0_ng_template_27_Template","ProjectEditorComponent_div_0_Template_button_click_33_listener","exportPdf","ProjectEditorComponent_div_0_Template_button_click_35_listener","exportCsv","pdfUrl","length","noTerminals_r13","noDrops_r14","noFiber_r15","noConduits_r16","ProjectEditorComponent","constructor","route","apiService","stateService","markers","polylines","markerLinks","markers$","subscribe","m","polylines$","p","conduits$","c","markerLinks$","l","ngOnInit","params","parseInt","loadProject","getProject","project","setProject","window","location","protocol","hostname","loadProjectData","error","console","getMarkers","setMarkers","getPolylines","setPolylines","getConduits","setConduits","getMarkerLinks","links","setMarkerLinks","event","canvas","fiberPolylines","filter","type","map","idx","id","project_id","points","lengthFt","t","x","y","marker_type","dropMarkers","d","setMarkerMode","mode","terminal","drop","fiber","confirm","conduit","onCalibrationChanged","calibration","log","pageWidth","pageHeight","blob","downloadFile","filename","url","URL","createObjectURL","link","document","createElement","href","download","click","revokeObjectURL","ɵɵdirectiveInject","i1","ActivatedRoute","i2","ApiService","i3","StateService","selectors","decls","vars","consts","template","ProjectEditorComponent_Template","rf","ctx","ProjectEditorComponent_div_0_Template","i4","NgForOf","NgIf","styles"],"sources":["/home/dfirth2/fiber_route_calculator/frontend-angular/src/app/components/project-editor/project-editor.component.ts"],"sourcesContent":["import { Component, OnInit, ViewChild } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { ActivatedRoute } from '@angular/router';\nimport { ApiService } from '../../core/services/api.service';\nimport { StateService, Marker, Polyline, Conduit, MarkerLink } from '../../core/services/state.service';\nimport { PDFViewerComponent } from '../pdf-viewer/pdf-viewer.component';\nimport { DrawingCanvasComponent } from '../drawing-canvas/drawing-canvas.component';\n\n@Component({\n  selector: 'app-project-editor',\n  standalone: true,\n  imports: [\n    CommonModule, \n    FormsModule,\n    PDFViewerComponent,\n    DrawingCanvasComponent\n  ],\n  template: `\n    <div *ngIf=\"projectId\" class=\"grid grid-cols-4 gap-4 h-full\">\n      <div class=\"col-span-3 flex flex-col relative\">\n        <app-pdf-viewer \n          [pdfUrl]=\"pdfUrl\"\n          (canvasReady)=\"onCanvasReady($event)\"\n          (polylinesChanged)=\"onPolylinesChanged($event)\"\n          (terminalsChanged)=\"onTerminalsChanged($event)\"\n          (dropsChanged)=\"onDropsChanged($event)\"\n        ></app-pdf-viewer>\n        <div *ngIf=\"pdfCanvas && viewport\" class=\"absolute inset-0\">\n          <app-drawing-canvas \n            [pdfCanvas]=\"pdfCanvas\"\n            [viewport]=\"viewport\"\n            [isActive]=\"markerMode === 'terminal' || markerMode === 'dropPed'\"\n            [projectId]=\"projectId\"\n          ></app-drawing-canvas>\n        </div>\n      </div>\n\n      <aside class=\"col-span-1 bg-white border rounded p-4 space-y-4 overflow-y-auto\">\n        <div class=\"space-y-2\">\n          <h3 class=\"font-semibold text-sm\">Terminals ({{ terminals.length }})</h3>\n          <ul class=\"space-y-1 text-sm text-gray-700\" *ngIf=\"terminals.length; else noTerminals\">\n            <li *ngFor=\"let t of terminals; let i = index\" class=\"flex justify-between items-center bg-gray-50 p-2 rounded\">\n              <span>Terminal {{ String.fromCharCode(65 + i) }}</span>\n              <button (click)=\"removeTerminal(t)\" class=\"text-xs text-red-600 hover:text-red-800\">Remove</button>\n            </li>\n          </ul>\n          <ng-template #noTerminals><div class=\"text-xs text-gray-500\">None placed</div></ng-template>\n        </div>\n\n        <div class=\"space-y-2\">\n          <h3 class=\"font-semibold text-sm\">Drop Peds ({{ drops.length }})</h3>\n          <ul class=\"space-y-1 text-sm text-gray-700\" *ngIf=\"drops.length; else noDrops\">\n            <li *ngFor=\"let d of drops; let i = index\" class=\"flex justify-between items-center bg-gray-50 p-2 rounded\">\n              <span>Drop Ped {{ String.fromCharCode(65 + i) }}</span>\n              <button (click)=\"removeDrop(d)\" class=\"text-xs text-red-600 hover:text-red-800\">Remove</button>\n            </li>\n          </ul>\n          <ng-template #noDrops><div class=\"text-xs text-gray-500\">None placed</div></ng-template>\n        </div>\n\n        <div class=\"space-y-2\">\n          <h3 class=\"font-semibold text-sm\">Fiber Segments ({{ fiberSegments.length }})</h3>\n          <ul class=\"space-y-1 text-sm text-gray-700\" *ngIf=\"fiberSegments.length; else noFiber\">\n            <li *ngFor=\"let seg of fiberSegments\" class=\"flex justify-between items-center bg-gray-50 p-2 rounded\">\n              <span>{{ seg.name || 'Route' }} – page {{ seg.page_number }} – {{ seg.length_ft ? seg.length_ft.toFixed(1) : '0.0' }} ft</span>\n              <button (click)=\"removeFiber(seg)\" class=\"text-xs text-red-600 hover:text-red-800\">Remove</button>\n            </li>\n          </ul>\n          <ng-template #noFiber><div class=\"text-xs text-gray-500\">No fiber drawn</div></ng-template>\n        </div>\n\n        <div class=\"space-y-2\">\n          <h3 class=\"font-semibold text-sm\">Links & Conduits ({{ conduits.length }})</h3>\n          <ul class=\"space-y-1 text-sm text-gray-700\" *ngIf=\"conduits.length; else noConduits\">\n            <li *ngFor=\"let c of conduits\" class=\"flex justify-between items-center bg-gray-50 p-2 rounded\">\n              <span>Terminal {{ c.terminal_id }} → Drop {{ c.drop_ped_id }} — {{ c.footage ? c.footage.toFixed(1) : '0.0' }} ft (page {{ c.page_number }})</span>\n              <button (click)=\"removeConduit(c)\" class=\"text-xs text-red-600 hover:text-red-800\">Remove</button>\n            </li>\n          </ul>\n          <ng-template #noConduits><div class=\"text-xs text-gray-500\">No conduits linked</div></ng-template>\n        </div>\n\n        <div class=\"space-y-2\">\n          <h3 class=\"font-semibold text-sm\">Exports</h3>\n          <div class=\"flex flex-wrap gap-2\">\n            <button (click)=\"exportPdf()\" class=\"px-3 py-2 rounded border hover:bg-gray-100\">Annotated PDF</button>\n            <button (click)=\"exportCsv()\" class=\"px-3 py-2 rounded border hover:bg-gray-100\">Materials CSV</button>\n          </div>\n        </div>\n      </aside>\n    </div>\n  `,\n  styles: [`\n    :host {\n      display: flex;\n      height: 100%;\n    }\n  `]\n})\nexport class ProjectEditorComponent implements OnInit {\n  projectId: number | null = null;\n  pdfUrl: string = '';\n  pdfCanvas: HTMLCanvasElement | null = null;\n  viewport: any = null;\n  markerMode: string | null = null;\n  markers: Marker[] = [];\n  polylines: Polyline[] = [];\n  conduits: Conduit[] = [];\n  markerLinks: MarkerLink[] = [];\n  String = String; // Make String accessible in templates\n\n  constructor(\n    private route: ActivatedRoute,\n    private apiService: ApiService,\n    private stateService: StateService\n  ) {\n    this.stateService.markers$.subscribe(m => this.markers = m);\n    this.stateService.polylines$.subscribe(p => this.polylines = p);\n    this.stateService.conduits$.subscribe(c => this.conduits = c);\n    this.stateService.markerLinks$.subscribe(l => this.markerLinks = l);\n  }\n\n  ngOnInit() {\n    this.route.params.subscribe((params) => {\n      this.projectId = parseInt(params['id']);\n      if (this.projectId) {\n        this.loadProject();\n      }\n    });\n  }\n\n  loadProject() {\n    if (!this.projectId) return;\n    this.apiService.getProject(this.projectId).subscribe(\n      (project) => {\n        this.stateService.setProject(project);\n        this.pdfUrl = `${window.location.protocol}//${window.location.hostname}:8000/api/projects/${this.projectId}/pdf`;\n        this.loadProjectData();\n      },\n      (error) => console.error('Failed to load project', error)\n    );\n  }\n\n  loadProjectData() {\n    if (!this.projectId) return;\n    this.apiService.getMarkers(this.projectId).subscribe((markers) => {\n      this.stateService.setMarkers(markers);\n    });\n    this.apiService.getPolylines(this.projectId).subscribe((polylines) => {\n      this.stateService.setPolylines(polylines);\n    });\n    this.apiService.getConduits(this.projectId).subscribe((conduits) => {\n      this.stateService.setConduits(conduits);\n    });\n    this.apiService.getMarkerLinks(this.projectId).subscribe((links) => {\n      this.stateService.setMarkerLinks(links);\n    });\n  }\n\n  onCanvasReady(event: any) {\n    this.pdfCanvas = event.canvas;\n    this.viewport = event.viewport;\n  }\n\n  onPolylinesChanged(polylines: any[]) {\n    // Update polylines with the local drawing data from pdf-viewer\n    const fiberPolylines = polylines.filter(p => p.type === 'fiber').map((p, idx) => ({\n      id: -idx - 1, // negative IDs for unsaved items\n      project_id: this.projectId || 0,\n      page_number: 1,\n      name: `Fiber Route ${idx + 1}`,\n      points: p.points,\n      length_ft: p.lengthFt\n    }));\n    this.polylines = fiberPolylines;\n  }\n\n  onTerminalsChanged(terminals: any[]) {\n    // Update markers with the local terminal data from pdf-viewer\n    this.markers = terminals.map((t, idx) => ({\n      id: -idx - 1,\n      project_id: this.projectId || 0,\n      page_number: 1,\n      x: t.x,\n      y: t.y,\n      marker_type: 'terminal'\n    }));\n  }\n\n  onDropsChanged(drops: any[]) {\n    // Update markers with the local drop data from pdf-viewer\n    const dropMarkers = drops.map((d, idx) => ({\n      id: -(1000 + idx),\n      project_id: this.projectId || 0,\n      page_number: 1,\n      x: d.x,\n      y: d.y,\n      marker_type: 'drop'\n    }));\n    this.markers = [...this.markers.filter(m => m.marker_type === 'terminal'), ...dropMarkers];\n  }\n\n  setMarkerMode(mode: string) {\n    this.markerMode = this.markerMode === mode ? null : mode;\n  }\n\n  get terminals(): Marker[] {\n    return this.markers.filter(m => m.marker_type === 'terminal');\n  }\n\n  get drops(): Marker[] {\n    return this.markers.filter(m => m.marker_type === 'drop' || m.marker_type === 'dropPed');\n  }\n\n  get fiberSegments(): Polyline[] {\n    return this.polylines;\n  }\n\n  removeTerminal(terminal: Marker) {\n    this.markers = this.markers.filter(m => m !== terminal);\n  }\n\n  removeDrop(drop: Marker) {\n    this.markers = this.markers.filter(m => m !== drop);\n  }\n\n  removeFiber(fiber: Polyline) {\n    if (confirm(`Delete fiber cable \"${fiber.name || 'Route'}\" (${fiber.length_ft?.toFixed(1) || '0.0'} ft)? This cannot be undone.`)) {\n      this.polylines = this.polylines.filter(p => p !== fiber);\n    }\n  }\n\n  removeConduit(conduit: Conduit) {\n    this.conduits = this.conduits.filter(c => c !== conduit);\n  }\n\n  onCalibrationChanged(calibration: any) {\n    console.log('Calibration saved:', calibration);\n  }\n\n  exportPdf() {\n    if (!this.projectId) return;\n    this.apiService.exportPdf(this.projectId, 1, this.viewport?.pageWidth, this.viewport?.pageHeight).subscribe(\n      (blob) => {\n        this.downloadFile(blob, `project_${this.projectId}_annotated.pdf`);\n      }\n    );\n  }\n\n  exportCsv() {\n    if (!this.projectId) return;\n    this.apiService.exportCsv(this.projectId).subscribe(\n      (blob) => {\n        this.downloadFile(blob, `project_${this.projectId}_report.csv`);\n      }\n    );\n  }\n\n  private downloadFile(blob: Blob, filename: string) {\n    const url = window.URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    link.click();\n    window.URL.revokeObjectURL(url);\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}